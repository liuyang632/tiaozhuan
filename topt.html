<!DOCTYPE html>
<html>
<head>
    <title>频道跳转</title>
    <meta charset="UTF-8">
    <meta name="mobile-web-app-capable" content="yes">
    <style>
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s linear;
        }
        
        .overlay.active {
            visibility: visible;
            opacity: 1;
        }
        
        .message-box {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 300px;
        }
        
        .close-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
        }
    </style>
    <script>
        function openTVApp(channelNum) {
            // 根据Manifest中定义的Intent Filter构造正确的Intent URI
            const intentUri = `intent://change_channel_by_num/${channelNum}#Intent;
                action=com.fengyun.live.action.CHANGE_CHANNEL_BY_NUM;
                package=com.fengyun.live;
                category=android.intent.category.BROWSABLE;
                S.channel_num=${channelNum};
                end`
                .replace(/\s/g, ''); // 去除换行和空格
            
            // 备用方案：若Intent URI失败，尝试直接调用Activity
            const backupUri = `com.fengyun.live/.tv.core.main.ThirdLaunchActivity?channel_num=${channelNum}`;
            
            const startTime = Date.now();
            let isAppOpened = false;

            // 尝试通过Intent唤醒应用
            const tryLaunchApp = () => {
                window.location.href = intentUri;
                
                // 检测应用是否成功打开（通过页面隐藏状态判断）
                const checkTimeout = setTimeout(() => {
                    if (!isAppOpened && Date.now() - startTime < 6000) {
                        // 尝试备用方案
                        window.location.href = backupUri;
                        
                        // 最终检查
                        setTimeout(() => {
                            if (!isAppOpened) {
                                showMessage("无法打开应用，请确保已安装并授予相关权限");
                            }
                        }, 2000);
                    }
                }, 2000);

                // 监听页面可见性变化（应用打开会导致页面隐藏）
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        isAppOpened = true;
                        clearTimeout(checkTimeout);
                        document.removeEventListener('visibilitychange', arguments.callee);
                    }
                });
            };

            tryLaunchApp();
        }

        function showMessage(message) {
            const overlay = document.getElementById('messageOverlay');
            const messageContent = document.getElementById('messageContent');
            messageContent.textContent = message;
            overlay.classList.add('active');
        }
        
        function closeMessage() {
            const overlay = document.getElementById('messageOverlay');
            overlay.classList.remove('active');
        }
    </script>
</head>
<body>
    <h1>电视频道跳转</h1>
    <button onclick="openTVApp(11)">CCTV-1 (11频道)</button>
    <button onclick="openTVApp(22)">湖南卫视 (22频道)</button>
    
    <!-- 消息提示框 -->
    <div id="messageOverlay" class="overlay">
        <div class="message-box">
            <p id="messageContent"></p>
            <button class="close-btn" onclick="closeMessage()">关闭</button>
        </div>
    </div>
</body>
</html>    
